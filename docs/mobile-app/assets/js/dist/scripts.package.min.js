var TVMaze_API=function(){this.cache={},this.lastRequest=!1,this.lastResponse=!1};TVMaze_API.prototype.setCache=function(e,t){var s=(new Date).getTime();this.cache[e]={response:t,setAt:s},localStorage.setItem(e,JSON.stringify(this.cache[e]))},TVMaze_API.prototype.getCache=function(e){var t=(new Date).getTime();if(this.cache.hasOwnProperty(e)&&this.cache[e].setAt<t-300)return this.cache[e].response;if(localStorage.getItem(e)){var s=JSON.parse(localStorage.getItem(e));if(s.setAt<t-300)return s.response}return!1},TVMaze_API.prototype.removeExpiredCache=function(){},TVMaze_API.prototype.get=function(e,t){var s=this._request(),n=this,o=!1;if(!1===s)return!1;this.lastRequest=e;var i=this.getCache(e);return!1!==i?i.response:(s.open("GET","https://api.tvmaze.com/"+e,!0),s.send(),s.addEventListener("load",function(){o=JSON.parse(s.responseText),n.setCache(e,o),this.lastResponse=o,t(n,o)},!1),s.addEventListener("error",function(){o=JSON.parse(s.responseText),this.lastResponse=o,t(n,o)},!1),this)},TVMaze_API.prototype._request=function(){return!!window.XMLHttpRequest&&new XMLHttpRequest};var TVMaze_Controller=function(e){this.view=e.view,this.api=e.api;var o=this;window.onload=function(){document.getElementById("submit-search-shows")&&document.getElementById("submit-search-shows").addEventListener("click",function(e){e.preventDefault();var t=document.getElementById("input-search-shows").value;""!==t&&o.api.get("search/shows?q="+encodeURI(t),function(e,t){if(t&&0<t.length)for(var s=[],n=0;t.length;n++)s.push(new TVMaze_Model_Show(t[n].show));o.view.draw("view-shows",{shows:s})})})}},TVMaze_View=function(e){this.templates={}};TVMaze_View.prototype.draw=function(e,t){t=t&&"object"==typeof t?t:{};var s=this._template(e,t);document.getElementsByTagName("main")[0].innerHTML=s},TVMaze_View.prototype._template=function(e,t){var s=this.templates.hasOwnProperty(e)?this.templates[e]:document.getElementById("template-"+e).innerHTML;if(s)for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&(s=this._replaceAll(s,"{{ "+n+" }}",t[n]));return this._replaceAll(s,"{{.*}}","",!1)},TVMaze_View.prototype._escapeRegExp=function(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},TVMaze_View.prototype._replaceAll=function(e,t,s,n){return null===s&&(s=""),void 0!==n&&!1!==n&&(t=this._escapeRegExp(t)),void 0!==e&&""!==e&&e.replace(new RegExp(t,"g"),s)};var TVMaze_Interface_Model_API=function(){this.baseQuery=null};TVMaze_Interface_Model_API.prototype.get=function(e,t){return e=this.baseQuery+e,(new TVMaze_API).get(e,t)};var TVMaze_Model_Episode=function(){TVMaze_Interface_Model_API.call(this),this.baseQuery="episodes/"},TVMaze_Model_Season=function(e){TVMaze_Interface_Model_API.call(this),this.baseQuery="seasons/",this.id=e,this.episodes=[]};TVMaze_Model_Season.prototype.getId=function(){return this.id},TVMaze_Model_Season.prototype.setId=function(e){return this.id=e,this},TVMaze_Model_Season.prototype.getEpisodes=function(){if(this.id=id,this.episodes)return this.episodes;var e=this.get(this.baseQuery+this.id+"/episodes");if(e&&0<e.length)for(var t=0;t<e.length;t++)this.episodes.push(new TVMaze_Model_Episode(e[t]));return this.episodes};var TVMaze_Model_Show=function(){TVMaze_Interface_Model_API.call(this),this.baseQuery="shows/",this.seasons=[]},containerID="tv-maze-container";(TVMaze_Controller=new TVMaze_Controller({containerID:containerID,view:new TVMaze_View,api:new TVMaze_API})).view.draw("view-index");